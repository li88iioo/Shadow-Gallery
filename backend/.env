# ===========================================================
# Shadow Gallery 后端服务环境变量配置
# ===========================================================

# 这些变量定义了后端服务如何连接到外部服务），
# 以及一些运行时的行为。

# --- Redis 缓存配置 ---
# Redis 连接 URL。
# 如果使用我提供的 docker-compose.yml 启动 Redis，那么'redis://redis:6379' 是正确的。
# 'redis' 是 docker-compose 网络中 Redis 服务的名称，'6379'是 Redis 的默认端口。
REDIS_URL=redis://redis:6379

# --- 后端服务配置 ---
# 后端服务监听的端口。
# 默认是 13001。如果您想更改，请在这里设置。
# PORT=13001

# Node.js 运行环境模式。
# 'production' 模式通常会启用性能优化和更少的日志输出。
# 'development' 模式可能包含更多调试信息。
NODE_ENV=production

# --- 日志级别 ---
# 控制应用程序的日志输出详细程度。
# 可选值：debug, info, warn, error, fatal。
# 'info' 会输出信息、警告和错误日志。
LOG_LEVEL=info

# --- 照片目录路径 (通常无需在此配置) ---
# 这个变量在 docker-compose.yml 中直接设置，指向容器内部的/app/photos。
# 您宿主机上的照片路径是在 docker-compose.yml 的 volumes部分进行映射的。
# 例如：volumes: - /path/on/your/host:/app/photos:ro
# PHOTOS_DIR=/app/photos

# 调整速率限制 
# API 速率限制的时间窗口（分钟）
 RATE_LIMIT_WINDOW_MINUTES=1 
# 在一个时间窗口内，单个 IP 允许的最大请求数
 RATE_LIMIT_MAX_REQUESTS=500

 # --- 安全配置 ---
# 用于签发和验证登录 Token 的密钥，请修改为一个复杂的、随机的字符串
JWT_SECRET=your-own-very-long-and-random-secret-string-12345

# 超级管理员密码，用于修改关键设置
ADMIN_SECRET=admin

# --- CORS 配置（可选） ---
# 允许的跨域来源白名单，使用英文逗号分隔多个来源。
# 未配置则默认放行所有来源（建议生产环境务必配置）。
# 示例：仅允许前端IP或域名访问
# CORS_ALLOWED_ORIGINS=https://your-frontend.example.com,https://another.example.com


# --- 可选：设置服务 Redis 兜底缓存 ---
# 启用后，settings 将在 Redis 中做短期兜底缓存，更新会自动失效
# 建议：仅在 Redis 可用时开启；关闭不影响功能
SETTINGS_REDIS_CACHE=true

# --- 启用轮询模式（对 NFS 友好）：
WATCH_USE_POLLING=true

# --- AI 频控配置（可选） ---
# 每用户每日 AI 生成上限（默认 200）
# AI_DAILY_LIMIT=200
# 同一图片的冷却时间（秒，默认 60）
# AI_PER_IMAGE_COOLDOWN_SEC=60

# --- 内部请求预热（可选） ---
# 登录成功后用于后端自我预热的基础地址；不配置则使用本机端口
# BACKEND_INTERNAL_URL=http://backend:13001

# --- 可选：SQLite 性能调优（若不设置，使用合理默认）---
# 写前日志模式：WAL/DELETE/TRUNCATE 等（默认 WAL）
# SQLITE_JOURNAL_MODE=WAL
# 落盘策略：FULL/NORMAL/OFF（默认 NORMAL）
# SQLITE_SYNCHRONOUS=NORMAL
# 临时存储：MEMORY/FILE（默认 MEMORY）
# SQLITE_TEMP_STORE=MEMORY
# 缓存大小（负数=KB，默认 -8000 ≈ 8MB）
# SQLITE_CACHE_SIZE=-8000
# 内存映射大小（字节，默认 268435456 = 256MB）
# SQLITE_MMAP_SIZE=268435456
# 忙等待超时（毫秒，默认 10000）
# SQLITE_BUSY_TIMEOUT=10000